openapi: 3.0.3
info:
  title: POS API
  description: |
    Point of Sale REST API — ระบบขายหน้าร้าน รองรับหลายสาขา พร้อมฟีเจอร์ร้านยา

    ## Standardized Error Responses

    All endpoints use a consistent error response format:

    ```json
    {
      "errcode": "XX-Status-No",
      "error": "human-readable message"
    }
    ```

    **Error code format:** `XX-Status-No` where:
    - `XX` — feature prefix (e.g. `BR`=Branch, `PD`=Product, `OR`=Order, `AU`=Auth)
    - `Status` — HTTP status code (e.g. `400`, `401`, `403`, `500`)
    - `No` — sequential number within the feature+status group (e.g. `001`)

    **Feature prefixes:**

    | Prefix | Feature            |
    |--------|--------------------|
    | AU     | Authentication     |
    | BR     | Branch             |
    | CA     | Category           |
    | CU     | Customer           |
    | EM     | Employee           |
    | SU     | Supplier           |
    | RC     | Receive            |
    | OR     | Order              |
    | PD     | Product            |
    | SE     | Setting            |
    | PO     | Purchase Order     |
    | DO     | Delivery Order     |
    | CN     | Credit Note        |
    | BL     | Billing            |
    | QT     | Quotation          |
    | PM     | Promotion          |
    | CH     | Customer History   |
    | PT     | Patient            |
    | DI     | Dispensing         |
    | TR     | Stock Transfer     |
    | RP     | Report             |
    | DA     | Dashboard          |
    | SY     | System             |

    **Common HTTP error responses (all authenticated endpoints):**
    - `400 Bad Request` — invalid request body / missing required fields
    - `401 Unauthorized` — missing or invalid Bearer token
    - `403 Forbidden` — insufficient role permissions
    - `500 Internal Server Error` — unexpected server error
  version: 1.0.0

servers:
  - url: http://localhost:8586/api/pos/v1
    description: Local development

security:
  - BearerAuth: []

tags:
  - name: Products
    description: Product management, units, prices, stocks, lots
  - name: Orders
    description: POS orders and order items
  - name: Categories
    description: Product categories
  - name: Customers
    description: Customer management
  - name: Suppliers
    description: Supplier management
  - name: Receives
    description: Goods receiving (GR)
  - name: Branches
    description: Branch management
  - name: Employees
    description: Employee management
  - name: Dashboard
    description: Sales summary, charts, low-stock
  - name: Settings
    description: Branch-level settings
  - name: Purchase Orders
    description: Purchase Order (PO)
  - name: Delivery Orders
    description: Delivery Order (DO)
  - name: Credit Notes
    description: Credit Note (CN) with stock reversal
  - name: Billings
    description: Billing management
  - name: Quotations
    description: Quotation management
  - name: Promotions
    description: Promotion/discount rules
  - name: Customer History
    description: Customer activity log
  - name: Patients
    description: Patient profiles and drug allergy management
  - name: Dispensing Logs
    description: Pharmacist dispensing records
  - name: Stock Transfers
    description: Inter-branch stock transfers
  - name: Reports
    description: PDF/Excel reports, labels, QR codes

paths:
  # ─── Products ───────────────────────────────────────────────
  /products:
    get:
      tags: [Products]
      summary: List all products
      parameters:
        - $ref: '#/components/parameters/CategoryQuery'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProductDetail'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags: [Products]
      summary: Create product (ADMIN)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProductRequest'
      responses:
        '200':
          description: Created product
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/receive:
    post:
      tags: [Products]
      summary: Create product with receive (ADMIN)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductReceiveRequest'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/{productId}:
    get:
      tags: [Products]
      summary: Get product by ID
      parameters:
        - $ref: '#/components/parameters/ProductId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductDetail'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags: [Products]
      summary: Update product (ADMIN)
      parameters:
        - $ref: '#/components/parameters/ProductId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProductRequest'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags: [Products]
      summary: Delete product (ADMIN)
      parameters:
        - $ref: '#/components/parameters/ProductId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/{productId}/sold-first:
    delete:
      tags: [Products]
      summary: Clear sold-first quantity (ADMIN)
      parameters:
        - $ref: '#/components/parameters/ProductId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/serial-number/{serialNumber}:
    get:
      tags: [Products]
      summary: Get product by serial number
      parameters:
        - name: serialNumber
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/serial-number:
    get:
      tags: [Products]
      summary: Generate new serial number
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/{productId}/stocks:
    get:
      tags: [Products]
      summary: Get stocks by product ID
      parameters:
        - $ref: '#/components/parameters/ProductId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProductStock'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/stocks:
    post:
      tags: [Products]
      summary: Create product stock
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductStockRequest'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/stocks/{stockId}:
    put:
      tags: [Products]
      summary: Update product stock
      parameters:
        - $ref: '#/components/parameters/StockId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags: [Products]
      summary: Remove product stock
      parameters:
        - $ref: '#/components/parameters/StockId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/stocks/{stockId}/quantity:
    patch:
      tags: [Products]
      summary: Update stock quantity
      parameters:
        - $ref: '#/components/parameters/StockId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/stocks/sequence:
    patch:
      tags: [Products]
      summary: Update stock sequence ordering
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/units:
    post:
      tags: [Products]
      summary: Create product unit
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductUnitRequest'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/units/{unitId}:
    put:
      tags: [Products]
      summary: Update product unit
      parameters:
        - $ref: '#/components/parameters/UnitId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags: [Products]
      summary: Delete product unit
      parameters:
        - $ref: '#/components/parameters/UnitId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/{productId}/units:
    get:
      tags: [Products]
      summary: Get units by product ID
      parameters:
        - $ref: '#/components/parameters/ProductId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProductUnit'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/{productId}/prices:
    get:
      tags: [Products]
      summary: Get prices by product ID
      parameters:
        - $ref: '#/components/parameters/ProductId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/prices:
    post:
      tags: [Products]
      summary: Create product price
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/prices/{priceId}:
    put:
      tags: [Products]
      summary: Update product price
      parameters:
        - name: priceId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags: [Products]
      summary: Delete product price
      parameters:
        - name: priceId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/lots/expire-notify:
    get:
      tags: [Products]
      summary: Check expiring product lots
      security: []
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/{productId}/histories:
    get:
      tags: [Products]
      summary: Get product history by product ID
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/ProductId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProductHistory'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /products/histories:
    get:
      tags: [Products]
      summary: Get product history by date range
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/StartDate'
        - $ref: '#/components/parameters/EndDate'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProductHistory'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Orders ─────────────────────────────────────────────────
  /orders:
    post:
      tags: [Orders]
      summary: Create order (POS checkout)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      tags: [Orders]
      summary: List orders by date range
      parameters:
        - $ref: '#/components/parameters/StartDate'
        - $ref: '#/components/parameters/EndDate'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /orders/{orderId}:
    get:
      tags: [Orders]
      summary: Get order by ID
      parameters:
        - $ref: '#/components/parameters/OrderId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags: [Orders]
      summary: Delete order (ADMIN)
      parameters:
        - $ref: '#/components/parameters/OrderId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /orders/{orderId}/customer-code:
    patch:
      tags: [Orders]
      summary: Update customer code on order
      parameters:
        - $ref: '#/components/parameters/OrderId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /orders/{orderId}/products/{productId}:
    delete:
      tags: [Orders]
      summary: Delete order item by order+product (ADMIN)
      parameters:
        - $ref: '#/components/parameters/OrderId'
        - $ref: '#/components/parameters/ProductIdPath'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /orders/customers/{customerCode}:
    get:
      tags: [Orders]
      summary: Get orders by customer code
      parameters:
        - $ref: '#/components/parameters/CustomerCode'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /orders/items:
    get:
      tags: [Orders]
      summary: List order items by date range
      parameters:
        - $ref: '#/components/parameters/StartDate'
        - $ref: '#/components/parameters/EndDate'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /orders/items/{itemId}:
    get:
      tags: [Orders]
      summary: Get order item by ID
      parameters:
        - $ref: '#/components/parameters/ItemId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags: [Orders]
      summary: Delete order item (ADMIN)
      parameters:
        - $ref: '#/components/parameters/ItemId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /orders/items/products/{productId}:
    get:
      tags: [Orders]
      summary: Get order items by product ID (ADMIN)
      parameters:
        - $ref: '#/components/parameters/ProductIdPath'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /orders/item-details/products/{productId}:
    get:
      tags: [Orders]
      summary: Get order item details by product ID (ADMIN)
      parameters:
        - $ref: '#/components/parameters/ProductIdPath'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Categories ─────────────────────────────────────────────
  /categories:
    get:
      tags: [Categories]
      summary: List categories
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags: [Categories]
      summary: Create category
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CategoryRequest'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /categories/{categoryId}:
    get:
      tags: [Categories]
      summary: Get category by ID
      parameters:
        - $ref: '#/components/parameters/CategoryId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags: [Categories]
      summary: Update category
      parameters:
        - $ref: '#/components/parameters/CategoryId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags: [Categories]
      summary: Delete category
      parameters:
        - $ref: '#/components/parameters/CategoryId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /categories/{categoryId}/default:
    patch:
      tags: [Categories]
      summary: Set default category
      parameters:
        - $ref: '#/components/parameters/CategoryId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Customers ──────────────────────────────────────────────
  /customers:
    post:
      tags: [Customers]
      summary: Create customer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerRequest'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      tags: [Customers]
      summary: List customers
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /customers/{customerId}:
    get:
      tags: [Customers]
      summary: Get customer by ID
      parameters:
        - $ref: '#/components/parameters/CustomerId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags: [Customers]
      summary: Update customer
      parameters:
        - $ref: '#/components/parameters/CustomerId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags: [Customers]
      summary: Delete customer
      parameters:
        - $ref: '#/components/parameters/CustomerId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /customers/{customerId}/status:
    patch:
      tags: [Customers]
      summary: Update customer status
      parameters:
        - $ref: '#/components/parameters/CustomerId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /customers/code/{customerCode}:
    get:
      tags: [Customers]
      summary: Get customer by code
      parameters:
        - $ref: '#/components/parameters/CustomerCode'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Suppliers ──────────────────────────────────────────────
  /suppliers:
    post:
      tags: [Suppliers]
      summary: Create supplier
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      tags: [Suppliers]
      summary: List suppliers
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /suppliers/info:
    get:
      tags: [Suppliers]
      summary: Get supplier info
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      tags: [Suppliers]
      summary: Update supplier info
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /suppliers/{supplierId}:
    get:
      tags: [Suppliers]
      summary: Get supplier by ID
      parameters:
        - $ref: '#/components/parameters/SupplierId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags: [Suppliers]
      summary: Update supplier
      parameters:
        - $ref: '#/components/parameters/SupplierId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags: [Suppliers]
      summary: Delete supplier
      parameters:
        - $ref: '#/components/parameters/SupplierId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Receives ───────────────────────────────────────────────
  /receives:
    post:
      tags: [Receives]
      summary: Create receive (GR)
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      tags: [Receives]
      summary: List receives by date range
      parameters:
        - $ref: '#/components/parameters/StartDate'
        - $ref: '#/components/parameters/EndDate'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /receives/{receiveId}:
    get:
      tags: [Receives]
      summary: Get receive by ID
      parameters:
        - $ref: '#/components/parameters/ReceiveId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags: [Receives]
      summary: Update receive
      parameters:
        - $ref: '#/components/parameters/ReceiveId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags: [Receives]
      summary: Delete receive
      parameters:
        - $ref: '#/components/parameters/ReceiveId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /receives/{receiveId}/total-cost:
    patch:
      tags: [Receives]
      summary: Update receive total cost
      parameters:
        - $ref: '#/components/parameters/ReceiveId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /receives/{receiveId}/items:
    patch:
      tags: [Receives]
      summary: Update receive items
      parameters:
        - $ref: '#/components/parameters/ReceiveId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Branches ───────────────────────────────────────────────
  /branches:
    post:
      tags: [Branches]
      summary: Create branch (ADMIN)
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      tags: [Branches]
      summary: List branches
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /branches/{branchId}:
    get:
      tags: [Branches]
      summary: Get branch by ID
      parameters:
        - $ref: '#/components/parameters/BranchId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags: [Branches]
      summary: Update branch (ADMIN)
      parameters:
        - $ref: '#/components/parameters/BranchId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags: [Branches]
      summary: Delete branch (ADMIN)
      parameters:
        - $ref: '#/components/parameters/BranchId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /branches/{branchId}/status:
    patch:
      tags: [Branches]
      summary: Update branch status (ADMIN)
      parameters:
        - $ref: '#/components/parameters/BranchId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Employees ──────────────────────────────────────────────
  /employees:
    post:
      tags: [Employees]
      summary: Create employee (ADMIN)
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      tags: [Employees]
      summary: List employees
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /employees/{employeeId}:
    get:
      tags: [Employees]
      summary: Get employee by ID
      parameters:
        - $ref: '#/components/parameters/EmployeeId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags: [Employees]
      summary: Update employee (ADMIN)
      parameters:
        - $ref: '#/components/parameters/EmployeeId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags: [Employees]
      summary: Delete employee (ADMIN)
      parameters:
        - $ref: '#/components/parameters/EmployeeId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /employees/branch/{branchId}:
    get:
      tags: [Employees]
      summary: Get employees by branch ID
      parameters:
        - $ref: '#/components/parameters/BranchId'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Dashboard ──────────────────────────────────────────────
  /dashboard/summary:
    get:
      tags: [Dashboard]
      summary: Sales summary (total orders, revenue, cost, profit)
      parameters:
        - $ref: '#/components/parameters/StartDate'
        - $ref: '#/components/parameters/EndDate'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /dashboard/daily-chart:
    get:
      tags: [Dashboard]
      summary: Daily sales chart data (max 31 days)
      parameters:
        - $ref: '#/components/parameters/StartDate'
        - $ref: '#/components/parameters/EndDate'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /dashboard/low-stock:
    get:
      tags: [Dashboard]
      summary: Low-stock products
      parameters:
        - name: threshold
          in: query
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /dashboard/stock-report:
    get:
      tags: [Dashboard]
      summary: Stock report aggregate
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Settings ───────────────────────────────────────────────
  /settings:
    get:
      tags: [Settings]
      summary: Get branch settings
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Setting'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags: [Settings]
      summary: Upsert branch settings (ADMIN)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SettingRequest'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Purchase Orders ────────────────────────────────────────
  /purchase-orders:
    post:
      tags: [Purchase Orders]
      summary: Create purchase order (ADMIN)
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      tags: [Purchase Orders]
      summary: List purchase orders
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /purchase-orders/{id}:
    get:
      tags: [Purchase Orders]
      summary: Get purchase order by ID
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags: [Purchase Orders]
      summary: Update purchase order (ADMIN)
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags: [Purchase Orders]
      summary: Delete purchase order (ADMIN)
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Delivery Orders ────────────────────────────────────────
  /delivery-orders:
    post:
      tags: [Delivery Orders]
      summary: Create delivery order (ADMIN)
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      tags: [Delivery Orders]
      summary: List delivery orders
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /delivery-orders/{id}:
    get:
      tags: [Delivery Orders]
      summary: Get delivery order by ID
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags: [Delivery Orders]
      summary: Update delivery order (ADMIN)
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags: [Delivery Orders]
      summary: Delete delivery order (ADMIN)
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Credit Notes ───────────────────────────────────────────
  /credit-notes:
    post:
      tags: [Credit Notes]
      summary: Create credit note with stock reversal (ADMIN)
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      tags: [Credit Notes]
      summary: List credit notes
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /credit-notes/{id}:
    get:
      tags: [Credit Notes]
      summary: Get credit note by ID
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags: [Credit Notes]
      summary: Update credit note (ADMIN)
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags: [Credit Notes]
      summary: Delete credit note (ADMIN)
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Billings ───────────────────────────────────────────────
  /billings:
    post:
      tags: [Billings]
      summary: Create billing (ADMIN)
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      tags: [Billings]
      summary: List billings
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /billings/{id}:
    get:
      tags: [Billings]
      summary: Get billing by ID
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags: [Billings]
      summary: Update billing (ADMIN)
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags: [Billings]
      summary: Delete billing (ADMIN)
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Quotations ─────────────────────────────────────────────
  /quotations:
    post:
      tags: [Quotations]
      summary: Create quotation (ADMIN)
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      tags: [Quotations]
      summary: List quotations
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /quotations/{id}:
    get:
      tags: [Quotations]
      summary: Get quotation by ID
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags: [Quotations]
      summary: Update quotation (ADMIN)
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags: [Quotations]
      summary: Delete quotation (ADMIN)
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Promotions ─────────────────────────────────────────────
  /promotions:
    post:
      tags: [Promotions]
      summary: Create promotion (ADMIN)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PromotionRequest'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      tags: [Promotions]
      summary: List promotions
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /promotions/{id}:
    get:
      tags: [Promotions]
      summary: Get promotion by ID
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags: [Promotions]
      summary: Update promotion (ADMIN)
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags: [Promotions]
      summary: Delete promotion (ADMIN)
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /promotions/apply:
    post:
      tags: [Promotions]
      summary: Apply promotion code to order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplyPromotionRequest'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Customer History ───────────────────────────────────────
  /customer-histories:
    post:
      tags: [Customer History]
      summary: Create customer history entry
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerHistoryRequest'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /customer-histories/{customerCode}:
    get:
      tags: [Customer History]
      summary: Get customer history by code
      parameters:
        - $ref: '#/components/parameters/CustomerCode'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Patients (Pharmacy) ────────────────────────────────────
  /patients:
    post:
      tags: [Patients]
      summary: Create patient profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatientRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Patient'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      tags: [Patients]
      summary: List patients
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Patient'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /patients/{id}:
    get:
      tags: [Patients]
      summary: Get patient by ID
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Patient'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags: [Patients]
      summary: Update patient
      parameters:
        - $ref: '#/components/parameters/Id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePatientRequest'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags: [Patients]
      summary: Delete patient
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /patients/customer/{customerCode}:
    get:
      tags: [Patients]
      summary: Get patient by customer code
      parameters:
        - $ref: '#/components/parameters/CustomerCode'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /patients/{id}/allergy-check:
    post:
      tags: [Patients]
      summary: Check drug allergies for products
      parameters:
        - $ref: '#/components/parameters/Id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AllergyCheckRequest'
      responses:
        '200':
          description: List of allergy warnings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AllergyCheckResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Dispensing Logs (Pharmacy) ─────────────────────────────
  /dispensing-logs:
    post:
      tags: [Dispensing Logs]
      summary: Create dispensing log
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DispensingLogRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DispensingLog'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      tags: [Dispensing Logs]
      summary: List dispensing logs
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /dispensing-logs/{id}:
    get:
      tags: [Dispensing Logs]
      summary: Get dispensing log by ID
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /dispensing-logs/patient/{patientId}:
    get:
      tags: [Dispensing Logs]
      summary: Get dispensing logs by patient ID
      parameters:
        - name: patientId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Stock Transfers ────────────────────────────────────────
  /stock-transfers:
    post:
      tags: [Stock Transfers]
      summary: Create stock transfer (ADMIN)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StockTransferRequest'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      tags: [Stock Transfers]
      summary: List stock transfers (from/to current branch)
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /stock-transfers/{id}:
    get:
      tags: [Stock Transfers]
      summary: Get stock transfer by ID
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /stock-transfers/{id}/approve:
    patch:
      tags: [Stock Transfers]
      summary: Approve stock transfer (ADMIN)
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /stock-transfers/{id}/reject:
    patch:
      tags: [Stock Transfers]
      summary: Reject stock transfer (ADMIN)
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── Reports ────────────────────────────────────────────────
  /reports/receipt/{orderId}/pdf:
    get:
      tags: [Reports]
      summary: Receipt PDF
      parameters:
        - $ref: '#/components/parameters/OrderId'
      responses:
        '200':
          description: PDF file
          content:
            application/pdf: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/tax-invoice/{orderId}/pdf:
    get:
      tags: [Reports]
      summary: Tax invoice PDF
      parameters:
        - $ref: '#/components/parameters/OrderId'
      responses:
        '200':
          description: PDF file
          content:
            application/pdf: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/sales/pdf:
    get:
      tags: [Reports]
      summary: Sales report PDF
      parameters:
        - $ref: '#/components/parameters/StartDate'
        - $ref: '#/components/parameters/EndDate'
      responses:
        '200':
          description: PDF file
          content:
            application/pdf: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/sales/excel:
    get:
      tags: [Reports]
      summary: Sales report Excel
      parameters:
        - $ref: '#/components/parameters/StartDate'
        - $ref: '#/components/parameters/EndDate'
      responses:
        '200':
          description: Excel file
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/stocks/excel:
    get:
      tags: [Reports]
      summary: Stock report Excel
      responses:
        '200':
          description: Excel file
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/drug-label/{logId}/pdf:
    get:
      tags: [Reports]
      summary: Drug label stickers PDF (70x35mm)
      parameters:
        - name: logId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: PDF file
          content:
            application/pdf: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/pharmacy/khy9:
    get:
      tags: [Reports]
      summary: "KHY.9 — Drug receiving report (บัญชีรับยา)"
      parameters:
        - $ref: '#/components/parameters/StartDate'
        - $ref: '#/components/parameters/EndDate'
      responses:
        '200':
          description: PDF file
          content:
            application/pdf: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/pharmacy/khy10:
    get:
      tags: [Reports]
      summary: "KHY.10 — Dangerous drug sales report (บัญชีขายยาอันตราย)"
      parameters:
        - $ref: '#/components/parameters/StartDate'
        - $ref: '#/components/parameters/EndDate'
      responses:
        '200':
          description: PDF file
          content:
            application/pdf: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/pharmacy/khy11:
    get:
      tags: [Reports]
      summary: "KHY.11 — Specially controlled drug report (ยาควบคุมพิเศษ)"
      parameters:
        - $ref: '#/components/parameters/StartDate'
        - $ref: '#/components/parameters/EndDate'
      responses:
        '200':
          description: PDF file
          content:
            application/pdf: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/pharmacy/khy12:
    get:
      tags: [Reports]
      summary: "KHY.12 — Expired drug report"
      responses:
        '200':
          description: PDF file
          content:
            application/pdf: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/pharmacy/khy13:
    get:
      tags: [Reports]
      summary: "KHY.13 — Near-expiry drug report"
      parameters:
        - name: days
          in: query
          schema:
            type: integer
            default: 90
          description: Number of days to check ahead
      responses:
        '200':
          description: PDF file
          content:
            application/pdf: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/product-history/{productId}/pdf:
    get:
      tags: [Reports]
      summary: Product history PDF for specific product
      parameters:
        - $ref: '#/components/parameters/ProductId'
      responses:
        '200':
          description: PDF file
          content:
            application/pdf: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/product-history/pdf:
    get:
      tags: [Reports]
      summary: Product history PDF by date range
      parameters:
        - $ref: '#/components/parameters/StartDate'
        - $ref: '#/components/parameters/EndDate'
      responses:
        '200':
          description: PDF file
          content:
            application/pdf: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/customer-history/{customerCode}/pdf:
    get:
      tags: [Reports]
      summary: Customer history PDF
      parameters:
        - $ref: '#/components/parameters/CustomerCode'
      responses:
        '200':
          description: PDF file
          content:
            application/pdf: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/barcodes/pdf:
    post:
      tags: [Reports]
      summary: Barcode labels PDF (batch)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BarcodeRequest'
      responses:
        '200':
          description: PDF file
          content:
            application/pdf: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/price-tags/pdf:
    get:
      tags: [Reports]
      summary: Price tags PDF (all products)
      parameters:
        - $ref: '#/components/parameters/CategoryQuery'
      responses:
        '200':
          description: PDF file
          content:
            application/pdf: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/receives/summary/pdf:
    get:
      tags: [Reports]
      summary: Receive summary report PDF
      parameters:
        - $ref: '#/components/parameters/StartDate'
        - $ref: '#/components/parameters/EndDate'
      responses:
        '200':
          description: PDF file
          content:
            application/pdf: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/prices/pdf:
    get:
      tags: [Reports]
      summary: Price report PDF (all products)
      parameters:
        - $ref: '#/components/parameters/CategoryQuery'
      responses:
        '200':
          description: PDF file
          content:
            application/pdf: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/promptpay/pdf:
    get:
      tags: [Reports]
      summary: PromptPay QR code PDF
      parameters:
        - name: amount
          in: query
          schema:
            type: number
            format: double
      responses:
        '200':
          description: PDF file
          content:
            application/pdf: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /reports/promptpay/payload:
    get:
      tags: [Reports]
      summary: PromptPay EMVCo payload (JSON)
      parameters:
        - name: amount
          in: query
          schema:
            type: number
            format: double
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  payload:
                    type: string
                  promptPayId:
                    type: string
                  amount:
                    type: number
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

# ═══════════════════════════════════════════════════════════════
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  responses:
    BadRequest:
      description: Invalid request body or parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            errcode: "XX-400-001"
            error: "invalid request body"
    Unauthorized:
      description: Missing or invalid authentication token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            errcode: "AU-401-001"
            error: "missing authorization header"
    Forbidden:
      description: Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            errcode: "SY-403-002"
            error: "Don't have permission"
    NotFound:
      description: Resource or route not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            errcode: "SY-404-001"
            error: "Service Missing / Not found."
    InternalServerError:
      description: Unexpected server error (panic recovery)
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            errcode: "SY-500-001"
            error: "runtime error: index out of range"

  parameters:
    Id:
      name: id
      in: path
      required: true
      schema:
        type: string
    ProductId:
      name: productId
      in: path
      required: true
      schema:
        type: string
    ProductIdPath:
      name: productId
      in: path
      required: true
      schema:
        type: string
    StockId:
      name: stockId
      in: path
      required: true
      schema:
        type: string
    UnitId:
      name: unitId
      in: path
      required: true
      schema:
        type: string
    OrderId:
      name: orderId
      in: path
      required: true
      schema:
        type: string
    ItemId:
      name: itemId
      in: path
      required: true
      schema:
        type: string
    CategoryId:
      name: categoryId
      in: path
      required: true
      schema:
        type: string
    CustomerId:
      name: customerId
      in: path
      required: true
      schema:
        type: string
    CustomerCode:
      name: customerCode
      in: path
      required: true
      schema:
        type: string
    SupplierId:
      name: supplierId
      in: path
      required: true
      schema:
        type: string
    ReceiveId:
      name: receiveId
      in: path
      required: true
      schema:
        type: string
    BranchId:
      name: branchId
      in: path
      required: true
      schema:
        type: string
    EmployeeId:
      name: employeeId
      in: path
      required: true
      schema:
        type: string
    StartDate:
      name: startDate
      in: query
      required: true
      schema:
        type: string
        format: date-time
    EndDate:
      name: endDate
      in: query
      required: true
      schema:
        type: string
        format: date-time
    CategoryQuery:
      name: category
      in: query
      schema:
        type: string

  schemas:
    ErrorResponse:
      type: object
      properties:
        errcode:
          type: string
          description: "Feature-scoped error code in format XX-Status-No (e.g. BR-400-001)"
          example: "PD-400-001"
        error:
          type: string
          description: Human-readable error message
          example: "invalid request body"
      required: [errcode, error]

    Product:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        nameEn:
          type: string
        description:
          type: string
        price:
          type: number
        costPrice:
          type: number
        unit:
          type: string
        quantity:
          type: integer
        serialNumber:
          type: string
        category:
          type: string
        status:
          type: string
        drugInfo:
          $ref: '#/components/schemas/DrugInfo'
        createdDate:
          type: string
          format: date-time

    ProductDetail:
      allOf:
        - $ref: '#/components/schemas/Product'
        - type: object
          properties:
            units:
              type: array
              items:
                $ref: '#/components/schemas/ProductUnit'
            prices:
              type: array
              items:
                $ref: '#/components/schemas/ProductPrice'
            stocks:
              type: array
              items:
                $ref: '#/components/schemas/ProductStock'

    DrugInfo:
      type: object
      properties:
        genericName:
          type: string
        drugType:
          type: string
          enum: [DANGEROUS, SPECIALLY_CONTROLLED, HOUSEHOLD, EXTERNAL]
        dosageForm:
          type: string
        strength:
          type: string
        indication:
          type: string
        dosage:
          type: string
        sideEffects:
          type: string
        contraindications:
          type: string
        storageCondition:
          type: string
        manufacturer:
          type: string
        registrationNo:
          type: string
        isControlled:
          type: boolean

    ProductUnit:
      type: object
      properties:
        id:
          type: string
        productId:
          type: string
        unit:
          type: string
        size:
          type: integer
        costPrice:
          type: number
        volume:
          type: number
        volumeUnit:
          type: string
        barcode:
          type: string

    ProductPrice:
      type: object
      properties:
        id:
          type: string
        productId:
          type: string
        customerType:
          type: string
        price:
          type: number

    ProductStock:
      type: object
      properties:
        id:
          type: string
        productId:
          type: string
        branchId:
          type: string
        unitId:
          type: string
        quantity:
          type: integer
        costPrice:
          type: number

    ProductHistory:
      type: object
      properties:
        id:
          type: string
        branchId:
          type: string
        productId:
          type: string
        type:
          type: string
        description:
          type: string
        unit:
          type: string
        import:
          type: integer
        quantity:
          type: integer
        costPrice:
          type: number
        price:
          type: number
        balance:
          type: integer
        createdDate:
          type: string
          format: date-time

    CreateProductRequest:
      type: object
      required: [name, price, costPrice, unit, serialNumber]
      properties:
        name:
          type: string
        nameEn:
          type: string
        description:
          type: string
        price:
          type: number
        costPrice:
          type: number
        unit:
          type: string
        serialNumber:
          type: string
        category:
          type: string
        status:
          type: string
        drugInfo:
          $ref: '#/components/schemas/DrugInfo'

    UpdateProductRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        nameEn:
          type: string
        description:
          type: string
        category:
          type: string
        status:
          type: string
        drugInfo:
          $ref: '#/components/schemas/DrugInfo'

    ProductReceiveRequest:
      type: object
      required: [name, price, costPrice, serialNumber, lotNumber, expireDate]
      properties:
        name:
          type: string
        nameEn:
          type: string
        description:
          type: string
        price:
          type: number
        costPrice:
          type: number
        unit:
          type: string
        quantity:
          type: integer
        serialNumber:
          type: string
        category:
          type: string
        lotNumber:
          type: string
        expireDate:
          type: string
          format: date-time
        receiveId:
          type: string
        drugInfo:
          $ref: '#/components/schemas/DrugInfo'

    ProductStockRequest:
      type: object
      properties:
        productId:
          type: string
        unitId:
          type: string
        quantity:
          type: integer
        costPrice:
          type: number

    ProductUnitRequest:
      type: object
      properties:
        productId:
          type: string
        unit:
          type: string
        size:
          type: integer
        costPrice:
          type: number
        volume:
          type: number
        volumeUnit:
          type: string
        barcode:
          type: string

    CreateOrderRequest:
      type: object
      properties:
        customerCode:
          type: string
        items:
          type: array
          items:
            type: object
            properties:
              productId:
                type: string
              unitId:
                type: string
              quantity:
                type: integer
              price:
                type: number
        payments:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
                enum: [CASH, CREDIT, PROMPTPAY, TRANSFER]
              amount:
                type: number
        discount:
          type: number
        message:
          type: string

    CategoryRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string

    CustomerRequest:
      type: object
      required: [name]
      properties:
        customerType:
          type: string
          enum: [General, Wholesaler, Regular]
        name:
          type: string
        address:
          type: string
        phone:
          type: string
        email:
          type: string

    Setting:
      type: object
      properties:
        id:
          type: string
        branchId:
          type: string
        receiptFooter:
          type: string
        companyName:
          type: string
        companyAddress:
          type: string
        companyPhone:
          type: string
        companyTaxId:
          type: string
        logoUrl:
          type: string
        showCredit:
          type: boolean
        promptPayId:
          type: string

    SettingRequest:
      type: object
      properties:
        receiptFooter:
          type: string
        companyName:
          type: string
        companyAddress:
          type: string
        companyPhone:
          type: string
        companyTaxId:
          type: string
        logoUrl:
          type: string
        showCredit:
          type: boolean
        promptPayId:
          type: string

    PromotionRequest:
      type: object
      required: [code, name, discountType, discountValue]
      properties:
        code:
          type: string
        name:
          type: string
        discountType:
          type: string
          enum: [PERCENTAGE, FIXED]
        discountValue:
          type: number
        minOrderAmount:
          type: number
        maxDiscount:
          type: number
        startDate:
          type: string
          format: date-time
        endDate:
          type: string
          format: date-time
        productIds:
          type: array
          items:
            type: string
        status:
          type: string

    ApplyPromotionRequest:
      type: object
      required: [code, orderTotal]
      properties:
        code:
          type: string
        orderTotal:
          type: number
        productIds:
          type: array
          items:
            type: string

    CustomerHistoryRequest:
      type: object
      required: [customerCode, type, description]
      properties:
        customerCode:
          type: string
        type:
          type: string
        description:
          type: string
        reference:
          type: string

    Patient:
      type: object
      properties:
        id:
          type: string
        branchId:
          type: string
        customerCode:
          type: string
        idCard:
          type: string
        dateOfBirth:
          type: string
          format: date-time
        gender:
          type: string
        bloodType:
          type: string
        weight:
          type: number
        allergies:
          type: array
          items:
            $ref: '#/components/schemas/DrugAllergy'
        chronicDiseases:
          type: array
          items:
            type: string
        currentMedications:
          type: array
          items:
            type: string
        note:
          type: string
        createdDate:
          type: string
          format: date-time

    DrugAllergy:
      type: object
      properties:
        drugName:
          type: string
        reaction:
          type: string
        severity:
          type: string
          enum: [MILD, MODERATE, SEVERE]

    PatientRequest:
      type: object
      required: [customerCode]
      properties:
        customerCode:
          type: string
        idCard:
          type: string
        dateOfBirth:
          type: string
          format: date-time
        gender:
          type: string
        bloodType:
          type: string
        weight:
          type: number
        allergies:
          type: array
          items:
            $ref: '#/components/schemas/DrugAllergy'
        chronicDiseases:
          type: array
          items:
            type: string
        currentMedications:
          type: array
          items:
            type: string
        note:
          type: string

    UpdatePatientRequest:
      type: object
      properties:
        idCard:
          type: string
        dateOfBirth:
          type: string
          format: date-time
        gender:
          type: string
        bloodType:
          type: string
        weight:
          type: number
        allergies:
          type: array
          items:
            $ref: '#/components/schemas/DrugAllergy'
        chronicDiseases:
          type: array
          items:
            type: string
        currentMedications:
          type: array
          items:
            type: string
        note:
          type: string

    AllergyCheckRequest:
      type: object
      required: [productIds]
      properties:
        productIds:
          type: array
          items:
            type: string

    AllergyCheckResult:
      type: object
      properties:
        productId:
          type: string
        productName:
          type: string
        drugName:
          type: string
        reaction:
          type: string
        severity:
          type: string

    DispensingLog:
      type: object
      properties:
        id:
          type: string
        branchId:
          type: string
        orderId:
          type: string
        patientId:
          type: string
        items:
          type: array
          items:
            $ref: '#/components/schemas/DispensingItem'
        pharmacistName:
          type: string
        licenseNo:
          type: string
        note:
          type: string
        createdDate:
          type: string
          format: date-time

    DispensingItem:
      type: object
      properties:
        productId:
          type: string
        productName:
          type: string
        genericName:
          type: string
        quantity:
          type: integer
        unit:
          type: string
        dosage:
          type: string
        lotNumber:
          type: string

    DispensingLogRequest:
      type: object
      required: [orderId, patientId, items, pharmacistName, licenseNo]
      properties:
        orderId:
          type: string
        patientId:
          type: string
        items:
          type: array
          items:
            type: object
            required: [productId, quantity]
            properties:
              productId:
                type: string
              productName:
                type: string
              genericName:
                type: string
              quantity:
                type: integer
              unit:
                type: string
              dosage:
                type: string
              lotNumber:
                type: string
        pharmacistName:
          type: string
        licenseNo:
          type: string
        note:
          type: string

    StockTransferRequest:
      type: object
      required: [toBranchId, items]
      properties:
        toBranchId:
          type: string
        items:
          type: array
          items:
            type: object
            required: [productId, quantity]
            properties:
              productId:
                type: string
              stockId:
                type: string
              quantity:
                type: integer
        note:
          type: string

    BarcodeRequest:
      type: object
      required: [productIds]
      properties:
        productIds:
          type: array
          items:
            type: string
        copies:
          type: integer
          default: 1
